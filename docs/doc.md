# –ó–∞–º–µ—Ç–∫–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É

## JWT

# JWT.builder()

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –≤ —Ü–µ–ø–æ—á–∫–µ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JWT
—Ç–æ–∫–µ–Ω–∞ –≤ Kotlin/Spring Boot —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `io.jsonwebtoken` (JJWT):

```kotlin
val token = Jwts.builder()
    .claims()
    .subject("user123")
    .issuedAt(Date())
    .expiration(Date(System.currentTimeMillis() + 1000 * 60 * 60))
    .signWith(secretKey)
    .compact()
```

üîé **–ß—Ç–æ —Ç—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. **`Jwts.builder()`**
   –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç **JWT Builder**. –≠—Ç–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ
   –º–æ–∂–Ω–æ "—Å–æ–±—Ä–∞—Ç—å" —Ç–æ–∫–µ–Ω —à–∞–≥ –∑–∞ —à–∞–≥–æ–º.

---

2. **`.claims()`**
   –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Ç–æ–∫–µ–Ω **claims** (–ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É, "—Ç–µ–ª–æ"
   —Ç–æ–∫–µ–Ω–∞).
   Claims ‚Äî —ç—Ç–æ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä:

    * —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ (`sub`, `iat`, `exp`, `iss`, `aud`)
    * –∫–∞—Å—Ç–æ–º–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä `role: "ADMIN"`, `userId: 42`).

---

3. **`.subject("user123")`**
   –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **`sub` (subject claim)** ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—É–±—ä–µ–∫—Ç–∞ —Ç–æ–∫–µ–Ω–∞.
   –û–±—ã—á–Ω–æ —ç—Ç–æ:

    * `username`
    * `email`
    * `userId`

   üëâ –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏
   –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞.

---

4. **`.issuedAt(Date())`**
   –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **`iat` (issued at)** ‚Äî –≤—Ä–µ–º—è –≤—ã–ø—É—Å–∫–∞ —Ç–æ–∫–µ–Ω–∞.
   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ "—Å–≤–µ–∂–µ—Å—Ç–∏" —Ç–æ–∫–µ–Ω–∞ –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –ø—Ä–∏
   logout/refresh –º–µ—Ö–∞–Ω–∏–∑–º–∞—Ö.

---

5. **`.expiration(Date(...))`**
   –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **`exp` (expiration time)** ‚Äî –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.
   –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è **–Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º**.
   –û–±—ã—á–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è—é—Ç —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `15 –º–∏–Ω—É—Ç` –∏–ª–∏ `1 —á–∞—Å`.

---

6. **`.signWith(secretKey)`**
   –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω —Å –ø–æ–º–æ—â—å—é **—Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞** (–¥–ª—è HMAC) –∏–ª–∏ **–ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ
   –∫–ª—é—á–∞** (–¥–ª—è RSA/ECDSA).
   –ë–µ–∑ –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω –Ω–µ –±—É–¥–µ—Ç –∑–∞—â–∏—â—ë–Ω –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏.

   üîë –ó–¥–µ—Å—å –∏ –≤–∞–∂–µ–Ω —Ç–≤–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (`HS256` —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º 256-–±–∏—Ç–Ω—ã–π
   –∫–ª—é—á).

---

7. **`.compact()`**
   –ó–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –≤ –≤–∏–¥–µ **—Å—Ç—Ä–æ–∫–∏** (—Ç—Ä–∏ —á–∞—Å—Ç–∏,
   —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç–æ—á–∫–∞–º–∏: Header.Payload.Signature).

   –ü—Ä–∏–º–µ—Ä:

   ```
   eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMTIzIiwiaWF0IjoxNjk2MjM4MDAwLCJleHAiOjE2OTYyNDE2MDB9.DfX...
   ```

---

üìå –í –∏—Ç–æ–≥–µ:

* `subject` = –∫—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
* `issuedAt` = –∫–æ–≥–¥–∞ –≤—ã–¥–∞–Ω
* `expiration` = –¥–æ –∫–∞–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç
* `signWith` = –∑–∞—â–∏—Ç–∞ –ø–æ–¥–ø–∏—Å—å—é

---

# –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –±–∏–Ω userDetailsService

–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å üëå

–¢—ã –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ —á–∞—Å—Ç–æ —Å–æ–∑–¥–∞—é—Ç –±–∏–Ω `UserDetailsService`.
–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è **–∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω**, –µ—Å–ª–∏ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å
`CustomUserDetailsService`.

---

### üö© 1. –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –±–∏–Ω–∞?

–ï—Å–ª–∏ —Ç–≤–æ–π `CustomUserDetailsService` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `@Service`, Spring
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –µ–≥–æ –∫–∞–∫ –±–∏–Ω.
–í –ø—Ä–æ—Å—Ç–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ: Security –Ω–∞–π–¥—ë—Ç –µ–≥–æ –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

---

### üö© 2. –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —è–≤–Ω—ã–π –±–∏–Ω?

–ò–Ω–æ–≥–¥–∞ —Ç—ã —è–≤–Ω–æ –ø–∏—à–µ—à—å –≤ `@Configuration`:

```kotlin
@Configuration
class SecurityConfig {

    @Bean
    fun userDetailsService(userRepository: UserRepository): UserDetailsService =
        CustomUserDetailsService(userRepository)
}
```

–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª—É—á–∞—è—Ö:

1. **–Ø–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `AuthenticationManager`**
   –ö–æ–≥–¥–∞ —Ç—ã —Å–∞–º —Å—Ç—Ä–æ–∏—à—å `AuthenticationManager` —á–µ—Ä–µ–∑
   `AuthenticationManagerBuilder` –∏–ª–∏ `AuthenticationConfiguration`, Spring
   Security –æ–∂–∏–¥–∞–µ—Ç –±–∏–Ω `UserDetailsService`.
   –ï—Å–ª–∏ –æ–Ω –µ—Å—Ç—å ‚Äî –æ–Ω –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

2. **–¢–µ—Å—Ç—ã**
   –í —Ç–µ—Å—Ç–∞—Ö —É–¥–æ–±–Ω–æ –∑–∞–º–æ–∫–∞—Ç—å `UserDetailsService` –∏–ª–∏ –ø–æ–¥–º–µ–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π –±–∏–Ω (
   –Ω–∞–ø—Ä–∏–º–µ—Ä, InMemory). –ï—Å–ª–∏ —É —Ç–µ–±—è –±–∏–Ω –æ–ø—Ä–µ–¥–µ–ª—ë–Ω —è–≤–Ω–æ, —Ç—ã –ª–µ–≥–∫–æ –µ–≥–æ
   –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—à—å.

3. **–ì–∏–±–∫–æ—Å—Ç—å**
   –ò–Ω–æ–≥–¥–∞ —Ç—ã —Ö–æ—á–µ—à—å **–ø–æ–¥–º–µ–Ω–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**:

    * –≤ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å InMemory –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    * –≤ prod ‚Äî `CustomUserDetailsService` —Å –±–∞–∑–æ–π.
      –≠—Ç–æ –ø—Ä–æ—â–µ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥ —Å `@Bean`, —á–µ–º –Ω–∞–ø—Ä—è–º—É—é `@Service`.

---

### üö© 3. –ö–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ `@Service`?

–ï—Å–ª–∏ —É —Ç–µ–±—è **–æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∞–∑–∞ —á–µ—Ä–µ–∑ JPA)**, –∏ —Ç—ã *
*–Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—à—å –≤—Ä—É—á–Ω—É—é `AuthenticationManager`**, —Ç–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:

```kotlin
@Service
class CustomUserDetailsService(
    private val userRepository: UserRepository
) : UserDetailsService { ... }
```

Spring Security —Å–∞–º –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç —ç—Ç–æ—Ç –±–∏–Ω.

---

‚úÖ **–ò—Ç–æ–≥**
`@Bean userDetailsService(...)` –Ω—É–∂–µ–Ω, –∫–æ–≥–¥–∞ —Ç—ã —Ö–æ—á–µ—à—å **—è–≤–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å,
–∫–∞–∫–æ–π `UserDetailsService` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ç—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—à—å
`AuthenticationManager` –≤—Ä—É—á–Ω—É—é, —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ –ø–∏—à–µ—à—å —Ç–µ—Å—Ç—ã.
–í –ø—Ä–æ—Å—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ `@Service`.

---

# AuthenticationManager

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å üëç
`AuthenticationManager` ‚Äî —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Spring Security, –∫–æ—Ç–æ—Ä—ã–π
–æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–∞–º **–ø—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** (–ø—Ä–æ–≤–µ—Ä–∫—É –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è, —Ç–æ–∫–µ–Ω–∞ –∏
—Ç.–¥.).

---

## üîé –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ

* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `AuthenticationManager` –∏–º–µ–µ—Ç –≤—Å–µ–≥–æ –æ–¥–∏–Ω –º–µ—Ç–æ–¥:

```kotlin
interface AuthenticationManager {
    fun authenticate(authentication: Authentication): Authentication
}
```

* –ù–∞ –≤—Ö–æ–¥ –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç `Authentication` (–Ω–∞–ø—Ä–∏–º–µ—Ä,
  `UsernamePasswordAuthenticationToken` —Å –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º).
* –ù–∞ –≤—ã—Ö–æ–¥ –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π** –æ–±—ä–µ–∫—Ç `Authentication`, –≤
  –∫–æ—Ç–æ—Ä–æ–º —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –µ–≥–æ —Ä–æ–ª—è—Ö.
* –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å ‚Üí –∫–∏–¥–∞–µ—Ç—Å—è `AuthenticationException`.

## üõ† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

1. –í–Ω—É—Ç—Ä–∏ `AuthenticationManager` –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ü–µ–ø–æ—á–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** (
   `AuthenticationProvider`), –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —É–º–µ–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–≤–æ–π —Å–ø–æ—Å–æ–±
   –ª–æ–≥–∏–Ω–∞:

    * `DaoAuthenticationProvider` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑
      `UserDetailsService`
    * `JwtAuthenticationProvider` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω—ã
    * `LdapAuthenticationProvider` ‚Äî LDAP
    * –∏ —Ç.–¥.

2. –ö–æ–≥–¥–∞ —Ç—ã –≤—ã–∑—ã–≤–∞–µ—à—å `authenticationManager.authenticate(...)`, –æ–Ω –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç
   –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ –æ—Ç–¥–∞—ë—Ç –∑–∞–¥–∞—á—É —Ç–æ–º—É, –∫—Ç–æ —É–º–µ–µ—Ç –µ—ë –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å.

---

## üìå –ó–∞—á–µ–º –µ–≥–æ —Å—Ç—Ä–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é

–í Spring Boot 2 —Ä–∞–Ω—å—à–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –ø—Ä–æ—Å—Ç–æ –∏–Ω–∂–µ–∫—Ç–∏—Ç—å `AuthenticationManager`.
–í Spring Security 6 —á–∞—â–µ –¥–µ–ª–∞—é—Ç —Ç–∞–∫:

```kotlin
@Configuration
class SecurityConfig(
    private val userDetailsService: UserDetailsService,
    private val passwordEncoder: PasswordEncoder
) {

    @Bean
    fun authenticationManager(authenticationConfiguration: AuthenticationConfiguration): AuthenticationManager {
        return authenticationConfiguration.authenticationManager
    }
}
```

–∏–ª–∏ –±–æ–ª–µ–µ —è–≤–Ω–æ:

```kotlin
@Bean
fun authenticationManager(): AuthenticationManager {
    val provider = DaoAuthenticationProvider()
    provider.setUserDetailsService(userDetailsService)
    provider.setPasswordEncoder(passwordEncoder)
    return ProviderManager(provider)
}
```

---

## üìç –ì–¥–µ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

1. **–ü—Ä–∏ –ª–æ–≥–∏–Ω–µ**
   –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/login` —Å –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º, —Ç–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
   –≤—ã–∑—ã–≤–∞–µ—Ç `authenticationManager.authenticate(...)`.

    * –ï—Å–ª–∏ —É—Å–ø–µ—Ö ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å JWT.
    * –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí `BadCredentialsException`.

   ```kotlin
   val auth = authenticationManager.authenticate(
       UsernamePasswordAuthenticationToken(loginRequest.username, loginRequest.password)
   )
   ```

2. **–ü—Ä–∏ JWT-—Ñ–∏–ª—å—Ç—Ä–µ**
   –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞—Ç—å `authenticationManager` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ —É —Ç–µ–±—è
   –∫–∞—Å—Ç–æ–º–Ω—ã–π `AuthenticationProvider`).

---

‚úÖ **–ò—Ç–æ–≥**
`AuthenticationManager` ‚Äî —ç—Ç–æ –¥–≤–∏–∂–æ–∫, –∫–æ—Ç–æ—Ä—ã–π **–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**.
–û–±—ã—á–Ω–æ –æ–Ω —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `UserDetailsService + PasswordEncoder`, –Ω–æ —Ç—ã
–º–æ–∂–µ—à—å —Ä–∞—Å—à–∏—Ä–∏—Ç—å –µ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è JWT –∏–ª–∏ LDAP).
–°—Ç—Ä–æ–∏—Ç—å –µ–≥–æ —Å–∞–º–æ–º—É –Ω—É–∂–Ω–æ, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å **–ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞—Å—Ç–æ–º–Ω—ã–π –ª–æ–≥–∏–Ω-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä).


---

# AuthenticationProvider

–û—á–µ–Ω—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å üôå
–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º –ø–æ –∫—É—Å–æ—á–∫–∞–º, —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ –∏ –∑–∞—á–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥–µ –Ω—É–∂–µ–Ω —Ç–∞–∫–æ–π –±–∏–Ω.

---

## üìå `AuthenticationProvider` –≤ Spring Security

* `AuthenticationProvider` ‚Äî —ç—Ç–æ **–∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É
  –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å, —Ç–æ–∫–µ–Ω –∏ —Ç.–¥.).
* –£ `AuthenticationManager` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, –æ–Ω –ø—Ä–æ—Å—Ç–æ
  –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –∏—Ö –∏ —Å–º–æ—Ç—Ä–∏—Ç, –∫—Ç–æ —Å–º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å.

---

## üìå `DaoAuthenticationProvider`

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `AuthenticationProvider`, –∫–æ—Ç–æ—Ä–∞—è:

1. –ë–µ—Ä—ë—Ç –ª–æ–≥–∏–Ω –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ (`UsernamePasswordAuthenticationToken`).
2. –ß–µ—Ä–µ–∑ `UserDetailsService` –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ.
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª–∏ —Å –ø–æ–º–æ—â—å—é `PasswordEncoder`.
4. –ï—Å–ª–∏ –≤—Å—ë –æ–∫ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ `Authentication` —Å —Ä–æ–ª—è–º–∏.

---

## üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–≤–æ–π –±–∏–Ω

```kotlin
@Bean
fun authenticationProvider(repository: UserRepository): AuthenticationProvider =
    DaoAuthenticationProvider().also {
        it.setUserDetailsService(userDetailsService(repository)) // –∫–∞–∫ –∏—Å–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        it.setPasswordEncoder(encoder()) // –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–∞—Ä–æ–ª—å
    }
```

üîé –ó–¥–µ—Å—å:

* `DaoAuthenticationProvider()` ‚Äî —Å–æ–∑–¥–∞—ë–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
  —á–µ—Ä–µ–∑ –ë–î.
* `setUserDetailsService(...)` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫ –∏—Å–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ —Ç–≤–æ–π
  `CustomUserDetailsService`).
* `setPasswordEncoder(...)` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏ (
  –Ω–∞–ø—Ä–∏–º–µ—Ä, `BCryptPasswordEncoder`).

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å Spring Security:
üëâ "–ü—Ä–æ–≤–µ—Ä—è–π –ª–æ–≥–∏–Ω—ã —á–µ—Ä–µ–∑ –º–æ—é –ë–î (`UserRepository`) –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π –ø–∞—Ä–æ–ª–∏ –ø–æ –º–æ–µ–º—É
–ø—Ä–∞–≤–∏–ª—É (`encoder()`)".

---

## üìå –ó–∞—á–µ–º —è–≤–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–Ω?

1. –ß—Ç–æ–±—ã `AuthenticationManager` —Å–º–æ–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ (–æ–Ω –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –≤—Å–µ
   `AuthenticationProvider` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞).
2. –ß—Ç–æ–±—ã —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, **–∫–∞–∫–æ–π —Å–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä,
   —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ë–î).
3. –ß—Ç–æ–±—ã –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å / –ø–æ–¥–º–µ–Ω—è—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ in-memory –≤ dev).

---

‚úÖ **–ò—Ç–æ–≥**
–≠—Ç–æ—Ç –±–∏–Ω —Å–æ–∑–¥–∞—ë—Ç `DaoAuthenticationProvider`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ç–≤–æ—é –±–∞–∑—É (
`UserDetailsService`) –∏ —Ç–≤–æ–π `PasswordEncoder`.
–û–Ω –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã Spring Security –∑–Ω–∞–ª **–∫–∞–∫ –∏–º–µ–Ω–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ.

---

# DaoAuthenticationProvider deprecated

–î–∞, —Ç—ã –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–º–µ—Ç–∏–ª üëå
–í **Spring Security 6+** –º–Ω–æ–≥–∏–µ –≤–µ—â–∏, –∫ –∫–æ—Ç–æ—Ä—ã–º –º—ã –ø—Ä–∏–≤—ã–∫–ª–∏, –≤—Ä–æ–¥–µ
`DaoAuthenticationProvider` –∏ —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è `AuthenticationManager`, —Å—Ç–∞–ª–∏
–ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ `@Deprecated`.

---

### üö© –ü–æ—á–µ–º—É —Ç–∞–∫?

Spring Security —É–ø—Ä–æ—Å—Ç–∏–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

* –¢–µ–ø–µ—Ä—å –Ω–µ –Ω—É–∂–Ω–æ —Ä—É–∫–∞–º–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å `DaoAuthenticationProvider` –∏–ª–∏ –¥–∞–∂–µ
  `AuthenticationManager`.
* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å **`UserDetailsService`** –∏ **`PasswordEncoder`**
  –∫–∞–∫ –±–∏–Ω—ã, –∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å–∞–º —Å–æ–±–µ—Ä—ë—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –≤–Ω—É—Ç—Ä–∏.

---

### üìå –ü—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–≥–æ —Å—Ç–∏–ª—è (Spring Boot 3 / Security 6)

```kotlin
@Configuration
class SecurityConfig(
    private val userDetailsService: UserDetailsService
) {

    @Bean
    fun passwordEncoder(): PasswordEncoder = BCryptPasswordEncoder()

    @Bean
    fun securityFilterChain(http: HttpSecurity): SecurityFilterChain {
        http
            .csrf { it.disable() }
            .authorizeHttpRequests { auth ->
                auth.requestMatchers("/auth/**").permitAll()
                auth.anyRequest().authenticated()
            }
            .httpBasic { } // –∏–ª–∏ formLogin / JWT —Ñ–∏–ª—å—Ç—Ä

        return http.build()
    }

    // üîë –ì–ª–∞–≤–Ω–æ–µ ‚Äî –ø—Ä–æ—Å—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º userDetailsService
    @Bean
    fun userDetailsService(userRepository: UserRepository): UserDetailsService =
        CustomUserDetailsService(userRepository)
}
```

---

### üìç –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è?

* Spring –≤–∏–¥–∏—Ç —Ç–≤–æ–π –±–∏–Ω `UserDetailsService` + `PasswordEncoder`.
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç `DaoAuthenticationProvider` (—Ö–æ—Ç—å –æ–Ω –∏ deprecated, –Ω–æ
  –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –µ–≥–æ –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç).
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç `AuthenticationManager`.

üëâ –¢–æ –µ—Å—Ç—å —Ç–µ–±–µ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å:

```kotlin
@Bean
fun authenticationProvider(...): AuthenticationProvider = ...
```

---

### ‚úÖ –ò—Ç–æ–≥

* `DaoAuthenticationProvider` –ø–æ–¥—Å–≤–µ—á–µ–Ω `deprecated`, –ø–æ—Ç–æ–º—É —á—Ç–æ **–µ–≥–æ –≤—Ä—É—á–Ω—É—é
  —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–æ–ª—å—à–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**.
* –¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å:

    * `UserDetailsService` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–≤–æ–π `CustomUserDetailsService`)
    * `PasswordEncoder` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `BCryptPasswordEncoder`)
* Spring Security —Å–æ–±–µ—Ä—ë—Ç –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---
